<!DOCTYPE html>
<html  lang="en-gb" >
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Hugo 0.54.0" />
    
    <title>Providing injectable features to Angular modules - Ideas and stuff</title>

    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,700,800"
      rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.7.2/css/all.css"
      integrity="sha384-6jHF7Z3XI3fF4XZixAuSu0gGKrXwoX/w3uFPxC56OtjChio7wtTGJWRW53Nhx6Ev"
      crossorigin="anonymous" />

    <link href="https://tane.dev/css/normalize.css" rel="stylesheet" />

    
    <link
      rel="stylesheet"
      href="https://tane.dev/scss/main.css"
      integrity="" />
  </head>

  <body class="light">
    <div class="container-left"> 

<div class="row">
  <div class="column sidebar">
    <div class="sidebar-content">
  <h1 class="site-title flex-item flex-start"><a href="https://tane.dev" title="Click here to go back to the home page">tane.dev</a></h1>
  <h2 class="flex-item subtitle">[ ideas <sup>(and stuff) <a href="https://tane.dev/about" title="Click on this link to go to the about page"><sup>(about)</sup></a></sup> ]</h2>
  
  <div class="service-buttons">
    <a href="https://github.com/tanepiper" title="Link to my Github account" target="_new"><i class="fab fa-github-alt"></i></a>
    <a href="https://twitter.com/tanepiper" title="Link to my Twitter account" target="_new"><i class="fab fa-twitter"></i></a>
    <a href="https://linkedin.com/in/tanepiper" title="Link to my LinkedIn account" target="_new"><i class="fab fa-linkedin"></i></a>
  </div>


  

  <aside class="menu">
    <ul class="sidebar-menus menu-list">
      
    </ul>

    <h3 class="menu-label">Recent Posts:</h3>
    <ul class="menu-list">
      
      <li>
        <a href="https://tane.dev/2019/03/providing-injectable-features-to-angular-modules/">Providing injectable features to Angular modules</a>
      </li>
      
      <li>
        <a href="https://tane.dev/2019/03/new-blog-hey-im-moving-from-medium/">New blog (&#39;Hey I&#39;m Moving From Medium&#39;)</a>
      </li>
      
    </ul>
  </aside>

  <div class="theme-buttons">
  <button class="flex-item btn btn-circle btn-light" title="Click this button for the light theme" aria-label="Click this button for the light theme" />
  <button class="flex-item btn btn-circle btn-dark" title="Click this button for the dark theme" aria-label="Click this button for the dark theme" />
</div>
<script src="https://tane.dev/js/theme-switcher.js"></script>

</div>

  </div>
  <main class="column main">
    <div class="post content">
      <div class="post-heading">
        <h1>
          <a href="https://tane.dev/2019/03/providing-injectable-features-to-angular-modules/">Providing injectable features to Angular modules</a>
        </h1>
        
          <span class="meta">
  <i class="far fa-calendar-edit"></i>&nbsp;Published: Mar 14, 2019
  
  (last updated: Mar 15, 2019)
  
  |&nbsp;<i class="far fa-pencil"></i>&nbsp;1700 words&nbsp;<i class="far fa-clock"></i>&nbsp;8 minutes reading time
</span>

          
  <span class="tags">
    
    <a href="https://tane.dev/tags/typescript">TypeScript</a>&nbsp;&nbsp;&nbsp;&nbsp;
    
    <a href="https://tane.dev/tags/angular">Angular</a>&nbsp;&nbsp;&nbsp;&nbsp;
    
    <a href="https://tane.dev/tags/development">Development</a>&nbsp;&nbsp;&nbsp;&nbsp;
    
    <a href="https://tane.dev/tags/tutorial">Tutorial</a>&nbsp;&nbsp;&nbsp;&nbsp;
    
  </span>


        
      </div>
      <div class="post-content">

<p>Working with <a href="https://angular.io/">Angular</a> and <a href="https://www.typescriptlang.org/">Typescript</a>; as I have refactored and re-written components I&rsquo;ve been learning to take advantage of one of the more powerful features - dependency injection.</p>

<p>Building Angular components, most developers will have already used this to inject features like the HTTP client or the FormBuilder to be used in a component. A common service example might look like this:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">HttpClient</span>, <span style="color:#a6e22e">HttpResponse</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/common/http&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Observable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;rxjs&#39;</span>;

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RequestService</span> {
  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">private</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">http</span>: <span style="color:#66d9ef">HttpClient</span>) {}

  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">getExample</span>()<span style="color:#f92672">:</span> <span style="color:#a6e22e">Observable</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">HttpResponse</span><span style="color:#f92672">&gt;</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/api/example&#39;</span>);
  }
}</code></pre></td></tr></table>
</div>
</div>
<p>Angular&rsquo;s own features can be injected via their class identity (e.g. <code>HttpClient</code>).  You can also inject any components, services or pipes that are registered within a module.</p>

<p>Angular also provides a mechanism for custom injections, this means items like configurations or instances of external libraries can be passed into any constructor within your module or any item within the dependency tree.  To do this the library needs to provide an <code>InjectionToken</code> which represents the key in the dependency tree, and use the <code>Inject</code> decorator to provide an instance into a class constructor (this is covered later in this post).</p>

<h2 id="creating-the-service">Creating The Service</h2>

<p>I recently worked on refactoring some code where in a component it had some code to handle getting a session object from <code>sessionStorage</code>. When working with Angular&rsquo;s <code>ng serve</code> making changes will often result in a refresh, destroying any existing session. This feature allowed session storage to be turned on and keep it between refreshes by allowing the component to check if a value existed in <code>sessionStorage</code> object.</p>

<p>Using the principles in <a href="https://en.wikipedia.org/wiki/SOLID">SOLID</a> I moved the code into a service. Having a service do one thing it made the code easier to understand. The unit test for this is also smaller and can cover most of the component.</p>

<p>The service has one additional property which is <code>storagePrefix</code>, used to make each instance of the service unique to it&rsquo;s component.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Injectable</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;

<span style="color:#66d9ef">@Injectable</span>()
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ComponentService</span> {
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">storagePrefix</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;my-app&#39;</span>;

  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">init</span>(<span style="color:#a6e22e">storagePrefix</span>: <span style="color:#66d9ef">string</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">storagePrefix</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">storagePrefix</span>;
  }

  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">load</span>(<span style="color:#a6e22e">key</span>: <span style="color:#66d9ef">string</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fromStorage</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">storagePrefix</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">key</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
  }

  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">save</span>(<span style="color:#a6e22e">key</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">value</span>: <span style="color:#66d9ef">string</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fromStorage</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sessionStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">storagePrefix</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">key</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, <span style="color:#a6e22e">value</span>);
  }
}</code></pre></td></tr></table>
</div>
</div>
<p>In it&rsquo;s current implementation it&rsquo;s usable, but it has a few issues.  The main one is that it uses <code>sessionStorage</code> but trusts that it exists on the global object, this means we should always expect it to be available, and is a bad practice.  It also limits this service to only use <code>sessionStorage</code> and no other key/value store. It would be better if we could provide it to our service instead.</p>

<p>We can also set the storagePrefix via our app configuration and means our component doesn&rsquo;t need to understand this configuration (yet!) so it avoids us having to call the <code>init</code> method within a component&rsquo;s <code>ngOnInit</code>.</p>

<p>By making these injectable, we will not only be able to provide our <code>sessionStorage</code> but we can support any module or
library that conforms to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API">Web Storage API</a>. This means we no longer need to rely on the global object and we have more control over what we inject.</p>

<p>The powerful feature of dependency injection is the ability to pass instances of other non-angular applications. For example you could pass the instance of a <code>jQuery</code> application and call it&rsquo;s methods from your application (you&rsquo;ll also want to check out <a href="https://angular.io/api/core/NgZone">NgZone</a> when running these, but I&rsquo;ll discuss that in a future post).</p>

<p>This allows for the transition of applications over time within an organisation, rather than having to replace all applications in one go. It&rsquo;s a good way to safely inject features from third-party libraries and means passing mock versions is easier for tests.</p>

<h2 id="creating-an-injectable-service-and-module">Creating an injectable service and module</h2>

<h3 id="making-out-features-injectable">Making out features injectable</h3>

<p>First we need to define the interface of the object want to use for the configuration. This interface provides a contract in the <code>forRoot</code> method described below and tells developers what options they can provide to the application</p>

<p>Our configuration will require a <code>storagePrefix</code> as a string - this is need to set the name of the store.  We also pass our <code>Storage</code> instance, but with this we can set a default value in our component</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ComponentServiceConfig</span> {
  <span style="color:#a6e22e">storagePrefix</span>: <span style="color:#66d9ef">string</span>;
  <span style="color:#a6e22e">storageInterface?</span>: <span style="color:#66d9ef">Storage</span>;
}</code></pre></td></tr></table>
</div>
</div>
<p>Next we will create an <code>InjectionToken</code>, a token that is usually constant representation of something we want to provide via dependency injection.  You can use any type of object as your token type, and can even provide a factory method to provide dependencies. Check out the <a href="https://angular.io/api/core/InjectionToken#tree-shakable-injectiontoken">Tree-shakeable Injection Token</a> to see how you can do some advanced use. In our case we will just have the component config object.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">InjectionToken</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">COMPONENT_SERVICE_CONFIG</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">InjectionToken</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">ComponentServiceConfig</span><span style="color:#f92672">&gt;</span>(<span style="color:#e6db74">&#39;COMPONENT_SERVICE_CONFIG&#39;</span>);</code></pre></td></tr></table>
</div>
</div>
<p>Now we have the token service we will provide a simple configuration with this token which will be an object, but a token can be used to inject anything from a string to a function, or even a class instance.</p>

<h3 id="making-an-angular-module-configurable">Making an Angular module configurable</h3>

<p>To make the service configurable, it should be provided via a <a href="https://angular.io/guide/ngmodules">NgModule</a> - a regular module might look something like this:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">NgModule</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">CommonModule</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/common&#39;</span>;
<span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ReactiveFormsModule</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/forms&#39;</span>;
<span style="color:#75715e">// Module specific imports ...
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">@NgModule</span>({
  <span style="color:#a6e22e">imports</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">CommonModule</span>, <span style="color:#a6e22e">ReactiveFormsModule</span>],
  <span style="color:#a6e22e">declarations</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">FeatureFormComponent</span>, <span style="color:#a6e22e">FeatureViewComponent</span>, <span style="color:#a6e22e">FeaturePipe</span>],
  <span style="color:#a6e22e">exports</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">FeatureFormComponent</span>, <span style="color:#a6e22e">FeatureViewComponent</span>],
  <span style="color:#a6e22e">provides</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">ComponentService</span>]
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LibraryModule</span> {}</code></pre></td></tr></table>
</div>
</div>
<p>To make this module accept a configuration we need to add a method that can return an instance of our module with custom providers. Providers are an important part of Angular&rsquo;s <a href="https://angular.io/guide/dependency-injection">dependency injection</a> as these are the instance of what child components can inject - all will hopefully become clear through the code example.</p>

<p>First we will add a static <code>forRoot</code> method to the class. This method provides a factory function where we can pass a configuration in the application imports.</p>

<p>The factory returns an instance of that module with the provided configuration, and this passed into the items with <code>Inject</code> . The module can then be further used without the <code>forRoot</code> as long as it&rsquo;s configured at the root of the application (see <a href="https://angular.io/api/core/SkipSelf">SkipSelf</a>)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">NgModule</span>, <span style="color:#a6e22e">ModuleWithProviders</span>, <span style="color:#a6e22e">Optional</span>, <span style="color:#a6e22e">SkipSelf</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;

<span style="color:#75715e">// Here we can create a default object
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">defaultConfig</span>: <span style="color:#66d9ef">ComponentServiceConfig</span> <span style="color:#f92672">=</span> {
  <span style="color:#a6e22e">storagePrefix</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;&#39;</span>,
  <span style="color:#a6e22e">storageInterface</span>: <span style="color:#66d9ef">sessionStorage</span>; <span style="color:#75715e">// In our default value we will trust the global is there 
</span><span style="color:#75715e"></span>}

<span style="color:#66d9ef">@NgModule</span>({
  ...
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LibraryModule</span> {
  <span style="color:#66d9ef">constructor</span>(
    <span style="color:#66d9ef">@Optional</span>()
    <span style="color:#66d9ef">@SkipSelf</span>()
    <span style="color:#a6e22e">parentModule</span>: <span style="color:#66d9ef">LibraryModule</span>,
  ) {}
  <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">forRoot</span>(<span style="color:#a6e22e">config?</span>: <span style="color:#66d9ef">ComponentServiceConfig</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">ModuleWithProviders</span> {
    <span style="color:#66d9ef">return</span> {
      <span style="color:#a6e22e">ngModule</span>: <span style="color:#66d9ef">LibraryModule</span>,
      <span style="color:#a6e22e">providers</span><span style="color:#f92672">:</span> [
        {
          <span style="color:#a6e22e">provide</span>: <span style="color:#66d9ef">COMPONENT_SERVICE_CONFIG</span>,
          <span style="color:#75715e">// Destructring allows the value of the config to be merged
</span><span style="color:#75715e"></span>          <span style="color:#75715e">// this is a shallow operation so keep the objects simple
</span><span style="color:#75715e"></span>          <span style="color:#a6e22e">useValue</span><span style="color:#f92672">:</span> { ...<span style="color:#a6e22e">defaultConfig</span>, ...<span style="color:#a6e22e">config</span> },
        },
      ],
    };
  }
}</code></pre></td></tr></table>
</div>
</div>
<p>Before we can use this in our application we also need to update the <code>ComponentService</code> itself to use this configuration. Here the <a href="https://angular.io/api/core/Inject">Inject</a> decorator will be used to tell the constructor that the <code>ComponentServiceConfig</code> this service needs will be available to inject via the <code>COMPONENT_SERVICE_CONFIG</code> token.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">Inject</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;@angular/core&#39;</span>;

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ComponentService</span> {
  <span style="color:#66d9ef">constructor</span>(<span style="color:#66d9ef">@Inject</span>(<span style="color:#a6e22e">COMPONENT_SERVICE_CONFIG</span>) <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">readonly</span> <span style="color:#a6e22e">config</span>: <span style="color:#66d9ef">ComponentServiceConfig</span>) {}

  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">load</span>(<span style="color:#a6e22e">key</span>: <span style="color:#66d9ef">string</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fromStorage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">storageInterface</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">storagePrefix</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">key</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
  }

  <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">save</span>(<span style="color:#a6e22e">key</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">value</span>: <span style="color:#66d9ef">string</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fromStorage</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">storageInterface</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">storagePrefix</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">key</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>, <span style="color:#a6e22e">value</span>);
  }
}</code></pre></td></tr></table>
</div>
</div>
<p>As the config is set with <code>private</code> in the constructor, TypeScript knows to set this as a property on the class. This is the same as writing the following code and provides a clean shorthand to set up properties.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ComponentService</span> {
  <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">config</span>: <span style="color:#66d9ef">ComponentServiceConfig</span>;

  <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">config</span>: <span style="color:#66d9ef">ComponentServiceConfig</span>) {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">config</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">config</span>;
  }
}</code></pre></td></tr></table>
</div>
</div>
<h3 id="providing-the-features-in-the-app">Providing the features in the app</h3>

<p>Now that we have our configurable module, the Angular application can be provided with a configuration when importing.</p>

<p>As the module now accepts any <code>Storage</code> type, we&rsquo;ll instead provide <code>localStorage</code> for this application, along side the <code>storagePrefix</code>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">@NgModule</span>({
  <span style="color:#a6e22e">declarations</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">AppComponent</span>],
  <span style="color:#a6e22e">imports</span><span style="color:#f92672">:</span> [
    <span style="color:#a6e22e">BrowserModule</span>,
    <span style="color:#a6e22e">RouterModule</span>.<span style="color:#a6e22e">forRoot</span>([], <span style="color:#a6e22e">routerConfig</span>),
    <span style="color:#a6e22e">LibraryModule</span>.<span style="color:#a6e22e">forRoot</span>({
      <span style="color:#a6e22e">storageInterface</span>: <span style="color:#66d9ef">localStorage</span>,
      <span style="color:#a6e22e">storagePrefix</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;my-new-app&#39;</span>
    })
  ],
  <span style="color:#a6e22e">providers</span><span style="color:#f92672">:</span> [...<span style="color:#a6e22e">environment</span>.<span style="color:#a6e22e">mockProviders</span>],
  <span style="color:#a6e22e">bootstrap</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">AppComponent</span>]
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppModule</span> {}</code></pre></td></tr></table>
</div>
</div>
<p>Another example is we could have an NPM library that provides the same interface, such as <a href="https://www.npmjs.com/package/localstorage-ponyfill">localStorage-ponyfill</a>, it could be used in your application - or you may want to provide it to a <code>TestBed</code> configuration:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7c7c79">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#75715e">// Using it in our application
</span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">createLocalStorage</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;localstorage-ponyfill&#34;</span>;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fakeLocalStorage</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">createLocalStorage</span>({ <span style="color:#a6e22e">mode</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;memory&#34;</span> });

<span style="color:#66d9ef">@NgModule</span>({
  <span style="color:#a6e22e">imports</span><span style="color:#f92672">:</span> [
    ...
    <span style="color:#a6e22e">LibraryModule</span>.<span style="color:#a6e22e">forRoot</span>({
      <span style="color:#a6e22e">storageInterface</span>: <span style="color:#66d9ef">fakeLocalStorage</span>,
      <span style="color:#a6e22e">storagePrefix</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;my-new-app&#39;</span>
    })
    ...
  ]
})
<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AppModule</span> {}

<span style="color:#75715e">// Or writing some tests
</span><span style="color:#75715e"></span>
<span style="color:#a6e22e">TestBed</span>.<span style="color:#a6e22e">configureTestingModule</span>({
  <span style="color:#a6e22e">declarations</span><span style="color:#f92672">:</span> [<span style="color:#a6e22e">TestHostComponent</span>],
  <span style="color:#a6e22e">providers</span><span style="color:#f92672">:</span> [
    {
      <span style="color:#a6e22e">provide</span>: <span style="color:#66d9ef">BB_FORMS_CONTAINER_CONFIG</span>,
      <span style="color:#a6e22e">useValue</span><span style="color:#f92672">:</span> {
        <span style="color:#a6e22e">storageStrategy</span>: <span style="color:#66d9ef">fakeLocalStorage</span>,
      },
    },
  ]
});</code></pre></td></tr></table>
</div>
</div>
<p>With this technique, any kind of primitive or complex object, method or class can now be passed into your feature modules - and is a useful way to provide third-party libraries to your modules, configuring not just your services, but also components, pipes and stores.</p>

<p>Any class with a <code>constructor</code> (provided it&rsquo;s in the same dependency tree) can use <code>Inject</code> with your exported token to access this configuration.</p>

<p>Hopefully you will also find this technique useful to improve the configurable and testable features of your module.  Feel free to <a href="https://twitter.com/tanepiper">respond on twitter</a> if you spot any typos or errors.</p>
</div>
    </div>
     <div class="page-navigation">
  
    
      <a href="https://tane.dev/2019/03/new-blog-hey-im-moving-from-medium/" class="previous"><i class="fas fa-arrow-square-left"></i> Previous Post</a>
    
  

  
  
</div>

  </main>
</div>
</div>

<footer class="footer">
  <div class="footer-content">
    
      &copy; 2019 Tane Piper.
     | 
    
      <a href="mailto:spam@tane.dev"><i class="far fa-mailbox"></i> Email to the void</a>
     | 
    Site built with <a href="http://gohugo.io">Hugo</a> 0.54.0 <i class="fas fa-hammer"></i> Last modified Mar 15, 2019.
  </div>
</footer>
</html>

