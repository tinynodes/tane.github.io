<!DOCTYPE html>
<html lang="en-gb">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="generator" content="Hugo 0.54.0" />
	
	<title>Dark patterns with the HTML 5.2 &lt;dialog&gt; tag and Chrome for fun and profit - Personal site of Tane Piper</title>

	
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
	<link href="https://tinynodes.github.io/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://tinynodes.github.io/css/strange-case.css" rel="stylesheet">
	

	
	
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
</head>
<body class="">

	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-4 col-md-3 col-lg-3 sidebar">

			
	<div class="sidebar-content">

		<a href="https://tinynodes.github.io"><h1>Tinynodes</h1></a>
		<p>Personal site of Tane Piper</p>

		

		<ul class="sidebar-menus">
			
		</ul>

		<div class="sidebar-recent hidden-xs">
			<p>Recent Posts:</p>
			<ul>
				
				<li><a href="https://tinynodes.github.io/blog/moving-from-medium/">Moving From Medium</a></li>
				
				<li><a href="https://tinynodes.github.io/blog/typescript-any-interface/">Typescript: Building up your types using a functional approach</a></li>
				
				<li><a href="https://tinynodes.github.io/blog/dialog-dark-patterns/">Dark patterns with the HTML 5.2 &lt;dialog&gt; tag and Chrome for fun and profit</a></li>
				
				<li><a href="https://tinynodes.github.io/takeoff/takeoff-support-for-blueprints/">Adding support for &#39;Blueprints&#39; in Takeoff</a></li>
				
				<li><a href="https://tinynodes.github.io/takeoff/takeoff-a-rapid-development-environment/">Takeoff: A Rapid Development Environment</a></li>
				
			</ul>
		</div>

		

		<p class="copyright">&copy; 2019. All rights reserved. </p>
		<p class="attr">Powered by <a href="http://gohugo.io">Hugo</a> &amp; <a href="https://github.com/ExchangeRate-API/strange-case">Strange Case</a> (inspired by <a href="https://github.com/poole/hyde">Hyde</a>).</p>

	</div>


			</div>
			<div class="col-sm-7 col-sm-offset-4 col-md-6 col-md-offset-3 col-lg-5 col-lg-offset-3 content">

				<div class="post">

					<div class="post-heading">
						<h1>Dark patterns with the HTML 5.2 &lt;dialog&gt; tag and Chrome for fun and profit</h1>
						<span class="post-date"><a href="https://tinynodes.github.io/blog/dialog-dark-patterns/"># Jan 31, 2018</a></span>
					</div>

					

<p>Recently I was introduced to the <code>&lt;dialog&gt;</code> tag and thought it was an interesting use of a web component pattern, but immediately I questioned the API and indeed after some minor digging, there really are some glaring issues regarding their use in terms of security, and as a major annoyance.</p>

<h2 id="the-hacks">The Hacks</h2>

<p>I’ve put them together in a Codepen and there are 4 main hacks:</p>

<ul>
<li>Adding a listener over a close button to make it nearly impossible for the user to close it.</li>
<li>Having a close button that when pressed closes the modal but also triggers an undesirable path.</li>
<li>2 Buttons that send you into an loop of death in creating modals.</li>
<li>Hijacking the Escape (and Tab) button</li>
</ul>

<p>The whole thing calls itself to get into a loop if you press the right buttons.</p>

<h2 id="overriding-the-dom-for-fun">Overriding the DOM for fun</h2>

<p>One issue is that you pretty much have full control over the DOM element of the dialog. This is good in many ways, but with great power&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createModal</span>() {
  <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">button</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;button&#34;</span>);
  <span style="color:#a6e22e">button</span>.<span style="color:#a6e22e">innerText</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Close Me&#34;</span>;

  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">moveModal</span>() {
    <span style="color:#a6e22e">button</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;disabled&#34;</span>, <span style="color:#66d9ef">true</span>);
    <span style="color:#a6e22e">button</span>.<span style="color:#a6e22e">innerText</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;LOL&#39;</span>;
    <span style="color:#a6e22e">lastX</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newModal</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">top</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#a6e22e">lastY</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">newModal</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">left</span> <span style="color:#f92672">||</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#a6e22e">newModal</span>.<span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">transform</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`translate(</span><span style="color:#e6db74">${</span>(<span style="color:#a6e22e">lastX</span> <span style="color:#f92672">*</span> Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.5</span>
        <span style="color:#f92672">?</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
        <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
        Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#ae81ff">250</span><span style="color:#e6db74">}</span><span style="color:#e6db74">px, </span><span style="color:#e6db74">${</span>(<span style="color:#a6e22e">lastY</span> <span style="color:#f92672">*</span> Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.5</span> <span style="color:#f92672">?</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
        Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> <span style="color:#ae81ff">250</span><span style="color:#e6db74">}</span><span style="color:#e6db74">px)`</span>;
    <span style="color:#a6e22e">button</span>.<span style="color:#a6e22e">removeAttribute</span>(<span style="color:#e6db74">&#34;disabled&#34;</span>);
  }
  
  <span style="color:#a6e22e">button</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;mouseenter&#39;</span>, <span style="color:#a6e22e">moveModal</span>);
  <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>}
</code></pre></div>
<p>With our annoying button, we use this to control the <code>transform</code> style of the modal itself and move it beyond the reach of the user. We add a second button that does close the modal using a call to <code>modal.close()</code> but after that we can trigger any JavaScript we want, such as loading new tabs, running bitcoin miners, searching for aliens, etc.</p>

<h2 id="blocking-the-escape-route">Blocking the Escape Route</h2>

<p>But of course most users might try press the Escape key in hopes that whatever is on the screen will disappear, but we have that particular route covered.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">open</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#34;.open&#34;</span>);

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">createModal</span>() {
  ...
}

<span style="color:#a6e22e">open</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;click&#34;</span>, <span style="color:#a6e22e">createModal</span>);

document.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;keyup&#34;</span>, <span style="color:#a6e22e">event</span> =&gt; {
    <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">preventDefault</span>();
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">keyCode</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">27</span>) {
        <span style="color:#a6e22e">open</span>.<span style="color:#a6e22e">click</span>();
    }
});
</code></pre></div>
<p>In this case we hijack when we detect the keycode for the Escape key, <code>ASCII 27</code> and we use it to just keep clicking the open button for creating the modal.</p>

<p>However it’s worse than that! As an added bonus pointed out to me if you also check for <code>ASCII 9, 13 and 32</code> as the Tab, Enter and Space characters so you can also punish the user for trying to use the keyboard to close the modal. The code that captures them, and the arrow keys is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">// Capture Escape, Enter, Tab, Space and arrow keys
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">eventKeys</span> <span style="color:#f92672">=</span> [<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">27</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">37</span>, <span style="color:#ae81ff">38</span>, <span style="color:#ae81ff">39</span>, <span style="color:#ae81ff">40</span>];  
</code></pre></div>
<h2 id="killing-the-browser">Killing the Browser</h2>

<p>It’s quite easy to create a stack overflow with the dialog by just calling a setInterval on it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">handleKill1</span>() {
  <span style="color:#a6e22e">setInterval</span>(<span style="color:#a6e22e">createModal</span>, <span style="color:#ae81ff">1000</span>);
}
</code></pre></div>
<p>Because this is quite easy to create from JavaScript alone, you have to be especially careful of 3rd-party scripts potentially using this to hijack pages using features built into the browser.</p>

<p>I’ve created another codepen with a web component that embeds the dialog in to a shadowroot and provides the global state so you cannot open more than one at a time.</p>

<p>Hopefully you enjoy the demo and this post, and this gives some pause for thought too in how we sometimes implement and use browser features. Users have already been taught bad habits for hitting buttons, especially on OSX these days.</p>


				</div>

			</div>
			<div class="col-sm-1 col-md-3 col-md-4">
			</div>
		</div>
	</div>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script src="https://tinynodes.github.io/js/bootstrap.min.js"></script>

</body>
</html>
